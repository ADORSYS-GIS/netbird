# Loki values for SingleBinary mode with filesystem storage
deploymentMode: SingleBinary

loki:
  auth_enabled: false
  
  # Storage configuration - MUST be under loki.storage for chart v6.x
  storage:
    type: filesystem
    filesystem:
      chunks_directory: /var/loki/chunks
      rules_directory: /var/loki/rules
    # PRODUCTION: Use object storage for scalability
    # type: s3  # or gcs, azure
    # s3:
    #   endpoint: s3.amazonaws.com
    #   region: us-east-1
    #   bucketnames: loki-chunks
    #   access_key_id: ${S3_ACCESS_KEY}
    #   secret_access_key: ${S3_SECRET_KEY}
  
  # Common configuration
  commonConfig:
    replication_factor: 1
    path_prefix: /var/loki
    ring:
      kvstore:
        store: inmemory
  
  # Schema configuration
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  
  # Limits configuration
  limits_config:
    retention_period: 720h
    reject_old_samples: true
    reject_old_samples_max_age: 168h
    ingestion_rate_mb: 100
    ingestion_burst_size_mb: 200
    per_stream_rate_limit: 50MB
    per_stream_rate_limit_burst: 100MB
    max_entries_limit_per_query: 100000
    max_streams_per_user: 0
    allow_structured_metadata: true
    volume_enabled: true
  
  # Pattern ingester
  pattern_ingester:
    enabled: true
  
  # Ruler configuration
  rulerConfig:
    enable_api: true
    storage:
      type: local
      local:
        directory: /var/loki/rules
  
  # Ingester settings
  ingester:
    chunk_encoding: snappy
  
  # Compactor for retention
  compactor:
    working_directory: /var/loki/compactor
    compaction_interval: 10m
    retention_enabled: true
    retention_delete_delay: 2h
    retention_delete_worker_count: 150
    delete_request_store: filesystem
  
  # Disable analytics
  analytics:
    reporting_enabled: false

# SingleBinary deployment configuration
singleBinary:
  replicas: 1
  persistence:
    enabled: true
    size: 3Gi
    # PRODUCTION: Use storageClassName
    # storageClassName: gp3
  
  affinity: {}
  
  # PRODUCTION: Resource limits
  resources: {}
  # resources:
  #   limits:
  #     cpu: 2000m
  #     memory: 2Gi
  #   requests:
  #     cpu: 500m
  #     memory: 512Mi

# Gateway configuration
gateway:
  enabled: true
  replicas: 1
  affinity: {}
  
  # PRODUCTION: Resource limits
  resources: {}
  # resources:
  #   limits:
  #     cpu: 500m
  #     memory: 256Mi
  #   requests:
  #     cpu: 100m
  #     memory: 128Mi
  
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
      
      # PRODUCTION: Uncomment for TLS
      # cert-manager.io/cluster-issuer: "letsencrypt-prod"
      # nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      # nginx.ingress.kubernetes.io/ssl-protocols: "TLSv1.2 TLSv1.3"
    
    hosts:
      - host: loki.local  # LOCAL
        # host: loki.yourdomain.com  # PRODUCTION
        paths:
          - path: /
            pathType: Prefix
    
    tls: []
    # PRODUCTION: Uncomment for TLS
    # tls:
    #   - secretName: loki-tls
    #     hosts:
    #       - loki.yourdomain.com

# CRITICAL: Explicitly disable all distributed components
backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0
ingester:
  replicas: 0
querier:
  replicas: 0
queryFrontend:
  replicas: 0
queryScheduler:
  replicas: 0
distributor:
  replicas: 0
compactor:
  replicas: 0
indexGateway:
  replicas: 0
bloomCompactor:
  replicas: 0
bloomGateway:
  replicas: 0

# Disable MinIO
minio:
  enabled: false

# Disable test
test:
  enabled: false

# Disable monitoring
monitoring:
  selfMonitoring:
    enabled: false
    grafanaAgent:
      installOperator: false
  lokiCanary:
    enabled: false

# Disable all cache components for single-node
chunksCache:
  enabled: false
resultsCache:
  enabled: false