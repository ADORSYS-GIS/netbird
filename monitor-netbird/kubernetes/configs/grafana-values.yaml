grafana:
  adminUser: admin
  # PRODUCTION: Use strong password or secret from external secret manager
  adminPassword: admin  # Change for production

  persistence:
    enabled: true
    type: pvc
    size: 1Gi
    # PRODUCTION: Use storageClassName for cloud storage
    # storageClassName: gp3  # AWS
    # storageClassName: standard-rwo  # GCP
    # storageClassName: managed-premium  # Azure

  service:
    type: ClusterIP
    port: 80
    targetPort: 3000

  # ingress:
  #   enabled: true
  #   ingressClassName: nginx
  #   annotations:
  #     # LOCAL: Basic rewrite
  #     nginx.ingress.kubernetes.io/rewrite-target: /
  #     
  #     # PRODUCTION: Uncomment below for TLS with cert-manager
  #     # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  #     # nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  #     # nginx.ingress.kubernetes.io/ssl-protocols: "TLSv1.2 TLSv1.3"
  #     # nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
  #   
  #   labels: {}
  #   
  #   path: /
  #   pathType: Prefix
  #   
  #   hosts:
  #     - grafana.local
  #     # - grafana.yourdomain.com  # PRODUCTION
  #   
  #   tls: []
  #   # PRODUCTION: Uncomment for TLS
  #   # tls:
  #   #   - secretName: grafana-tls
  #   #     hosts:
  #   #       - grafana.yourdomain.com

  env:
    GF_FEATURE_TOGGLES_ENABLE: publicDashboards
    GF_LOG_LEVEL: info
    GF_AUTH_ANONYMOUS_ENABLED: "false"
    
    # PRODUCTION: Security headers
    # GF_SECURITY_COOKIE_SECURE: "true"
    # GF_SECURITY_COOKIE_SAMESITE: "lax"
    # GF_SERVER_ROOT_URL: "https://grafana.yourdomain.com"

  # PRODUCTION: Resource limits
  resources: {}
  # resources:
  #   limits:
  #     cpu: 500m
  #     memory: 512Mi
  #   requests:
  #     cpu: 100m
  #     memory: 128Mi

  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          access: proxy
          url: http://monitoring-stack-prometheus-server:80
          isDefault: true
          jsonData:
            httpMethod: POST
            timeInterval: 15s

        - name: Loki
          type: loki
          access: proxy
          url: http://monitoring-stack-loki-gateway:80
          jsonData:
            maxLines: 1000

        - name: Mimir
          type: prometheus
          access: proxy
          url: http://monitoring-stack-mimir-nginx:8080/prometheus
          jsonData:
            httpMethod: POST
            timeInterval: 15s

        - name: Tempo
          type: tempo
          access: proxy
          url: http://tempo:3200
          jsonData:
            httpMethod: GET
            tracesToLogs:
              datasourceUid: "loki"
              tags: ["job", "instance", "pod", "namespace"]
              mappedTags: [{ key: "service.name", value: "service" }]
              mapTagNamesEnabled: false
              spanStartTimeShift: "1h"
              spanEndTimeShift: "1h"
              filterByTraceID: false
              filterBySpanID: false
            tracesToMetrics:
              datasourceUid: "prometheus"
              tags: [{ key: "service.name", value: "service" }, { key: "job" }]
              queries:
                - name: "Sample query"
                  query: "sum(rate(tempo_spanmetrics_latency_bucket{$$__tags}[5m]))"
            serviceMap:
              datasourceUid: "prometheus"
            search:
              hide: false
            nodeGraph:
              enabled: true
            lokiSearch:
              datasourceUid: "loki"

  testFramework:
    enabled: false