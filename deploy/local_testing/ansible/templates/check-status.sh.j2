#!/bin/bash
# NetBird Status Check Script
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

echo "=== NetBird Service Status ==="
cd {{ netbird_base_dir }}
docker compose ps

echo ""
echo "=== Service Health ==="
echo -n "Keycloak: "
curl -s -o /dev/null -w "%{http_code}" http://{{ netbird_external_domain }}:{{ netbird_keycloak_port }}/realms/master
echo ""

echo -n "Dashboard: "
curl -s -o /dev/null -w "%{http_code}" http://{{ netbird_external_domain }}:{{ netbird_dashboard_port }}
echo ""

echo -n "Management API: "
curl -s -o /dev/null -w "%{http_code}" http://{{ netbird_external_domain }}:{{ netbird_management_port }}
echo ""

echo ""
echo "=== Container Resources ==="
docker stats --no-stream | head -10

echo ""
echo "=== Disk Usage ==="
df -h {{ netbird_base_dir }}

echo ""
echo "=== Network Connectivity ==="
echo -n "External IP: "
curl -s https://ipinfo.io/ip 2>/dev/null || echo "Unable to detect"

echo ""
echo "=== Access URLs ==="
echo "ğŸ” Keycloak Admin: http://{{ netbird_external_domain }}:{{ netbird_keycloak_port }}/admin"
echo "ğŸŒ NetBird Dashboard: http://{{ netbird_external_domain }}:{{ netbird_dashboard_port }}"
echo "ğŸ“¡ Management API: http://{{ netbird_external_domain }}:{{ netbird_management_port }}"
