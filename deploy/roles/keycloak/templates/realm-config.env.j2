# ============================================================
# NetBird Keycloak Configuration
# ============================================================
# Generated by Ansible Keycloak role
# Date: {{ ansible_date_time.iso8601 }}
# Mode: {% if kc_is_deploy_mode %}Deploy (New Keycloak){% else %}External (Existing Keycloak){% endif %}

# ===========================================
# Keycloak Instance Details
# ===========================================
REALM_NAME={{ kc_realm_name }}
KEYCLOAK_HOST={{ kc_public_url }}
KEYCLOAK_ADMIN_CONSOLE={{ kc_public_url }}/admin/realms/{{ kc_realm_name }}

# ===========================================
# OIDC Configuration
# ===========================================
# Use this endpoint for NetBird configuration
OIDC_CONFIGURATION_ENDPOINT={{ netbird_oidc_configuration_endpoint }}
OIDC_ISSUER={{ kc_public_url }}/realms/{{ kc_realm_name }}

# ===========================================
# Client Credentials
# ===========================================
# Frontend Client (Public Client for Dashboard/CLI)
FRONTEND_CLIENT_ID={{ netbird_client_id }}
FRONTEND_CLIENT_AUDIENCE={{ netbird_audience }}
FRONTEND_CLIENT_TYPE=public

# Backend Client (Service Account for Management API)
BACKEND_CLIENT_ID={{ netbird_mgmt_client_id }}
BACKEND_CLIENT_SECRET={{ netbird_mgmt_client_secret }}
BACKEND_CLIENT_TYPE=confidential
BACKEND_ADMIN_ENDPOINT={{ netbird_mgmt_extra_admin_endpoint }}

# ===========================================
# OAuth 2.0 Endpoints
# ===========================================
AUTHORIZATION_ENDPOINT={{ kc_public_url }}/realms/{{ kc_realm_name }}/protocol/openid-connect/auth
TOKEN_ENDPOINT={{ kc_public_url }}/realms/{{ kc_realm_name }}/protocol/openid-connect/token
USERINFO_ENDPOINT={{ kc_public_url }}/realms/{{ kc_realm_name }}/protocol/openid-connect/userinfo
END_SESSION_ENDPOINT={{ kc_public_url }}/realms/{{ kc_realm_name }}/protocol/openid-connect/logout

# ===========================================
# Usage in NetBird Configuration
# ===========================================
# Use these values in your NetBird setup:
# - NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT="${OIDC_CONFIGURATION_ENDPOINT}"
# - NETBIRD_AUTH_AUDIENCE="${FRONTEND_CLIENT_AUDIENCE}"
# - NETBIRD_IDP_MGMT_CLIENT_ID="${BACKEND_CLIENT_ID}"
# - NETBIRD_IDP_MGMT_CLIENT_SECRET="${BACKEND_CLIENT_SECRET}"
# - NETBIRD_IDP_MGMT_EXTRA_ADMIN_ENDPOINT="${BACKEND_ADMIN_ENDPOINT}"
# UserInfo Endpoint: https://{{ keycloak_host }}/realms/{{ keycloak_realm }}/protocol/openid-connect/userinfo
