---
# Configure Keycloak realm and clients for NetBird integration
# DEPLOY MODE: Uses kcadm.sh CLI (direct container access)
# EXTERNAL MODE: Uses REST API (remote Keycloak)

# ========================================
# DEPLOY MODE - CLI-based configuration
# ========================================
- name: Include CLI-based configuration for deploy mode
  ansible.builtin.include_tasks: configure_realm_cli.yml
  when: kc_is_deploy_mode

# ========================================
# EXTERNAL MODE - API-based configuration
# ========================================
- name: Include API-based configuration for external mode
  ansible.builtin.include_tasks: configure_realm_api.yml
  when: not kc_is_deploy_mode

# ========================================
# Final configuration summary
# ========================================
- name: Display final configuration status
  ansible.builtin.debug:
    msg:
      - "âœ… Keycloak realm configuration completed"
      - "Mode: {{ 'Deploy (CLI)' if kc_is_deploy_mode else 'External (API)' }}"
      - "Realm: {{ kc_realm_name }}"
      - "Configuration saved for NetBird deployment"
