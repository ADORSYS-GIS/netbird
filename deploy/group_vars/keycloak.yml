# ============================================================
# Keycloak Deployment Mode Configuration
# ============================================================
# TO SWITCH MODES: Change these two flags and update relevant section below

# CURRENT MODE: External (Boss's Keycloak)
# TO SWITCH TO DEPLOY MODE:
#   1. Set keycloak_deploy_mode: true
#   2. Set keycloak_external_mode: false
#   3. Update "DEPLOY MODE Variables" section below

keycloak_deploy_mode: true # Deploy NEW Keycloak
keycloak_external_mode: false # Use EXISTING Keycloak

# ========================================
# DEPLOY MODE Variables
# ========================================
# Only used when keycloak_deploy_mode: true
# These configure a NEW Keycloak deployment

# Keycloak version to deploy
keycloak_version: "22.0"

# Domain/hostname for your NEW Keycloak
# Examples: "keycloak.yourcompany.com" or "10.165.218.128.nip.io"
keycloak_host: "localhost"

# Internal HTTP port (before reverse proxy)
keycloak_http_port: 8080

# Master realm admin credentials (for NEW Keycloak)
keycloak_admin_user: "admin"
keycloak_admin_password: "{{ vault_keycloak_admin_password }}"  # Use Ansible Vault!

# PostgreSQL password for Keycloak database
keycloak_db_password: "{{ vault_keycloak_db_password }}"  # Use Ansible Vault!

# ========================================
# EXTERNAL MODE Variables
# ========================================
# Only used when keycloak_external_mode: true
# These connect to an EXISTING Keycloak instance

# OIDC Discovery Endpoint of existing Keycloak
# Format: https://YOUR_KEYCLOAK_HOST/realms/YOUR_REALM/.well-known/openid-configuration
# Example: https://login.wazuh.adorsys.team/realms/netbird/.well-known/openid-configuration
keycloak_oidc_configuration_endpoint: "https://login.wazuh.adorsys.team/realms/netbird/.well-known/openid-configuration"

# Realm admin credentials for external mode
keycloak_realm_admin_user: "{{ vault_keycloak_realm_admin_user | default('netbird-backend') }}"
keycloak_realm_admin_password: "{{ vault_keycloak_realm_admin_password | default(vault_netbird_backend_client_secret) }}"

# SSL certificate validation
keycloak_validate_certs: true

# ========================================
# NetBird Client Configuration
# ========================================
# Used by BOTH deploy and external modes

# Realm name where NetBird clients will be created
keycloak_realm: "netbird"

# OAuth client names
keycloak_client_netbird: "netbird-client"  # Public client for Dashboard/CLI
keycloak_client_netbird_backend: "netbird-backend"  # Service account for Management API

# Valid redirect URIs for OAuth flow
# ⚠️ CRITICAL: Update YOUR_NETBIRD_DOMAIN with your actual AWS domain!
# Example: https://netbird.example.com/* or https://netbird.yourcompany.com/*
keycloak_valid_redirect_uris:
  - "https://netbird.example.com*"  # ⚠️ REPLACE THIS WITH YOUR AWS DOMAIN!
  - "https://login.wazuh.adorsys.team/*"  # Keycloak SSO origin
  - "http://localhost:53000"  # NetBird CLI local callback# Alternative CLI port

# Web origins for CORS
keycloak_web_origins: "+"  # Allows all origins (use specific origins in production)
